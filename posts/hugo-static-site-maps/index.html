<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-gb lang=en-gb><head><script src=https://georgek.github.io/blog/js/early.min.8bbbb9e374f9a31ff012ccd8e17b750da15211875e9e896d6ea765d7e3c2179a.js integrity="sha256-i7u543T5ox/wEszY4Xt1DaFSEYdenoltbqdl1+PCF5o="></script>
<script defer language=javascript type=text/javascript src=/blog/js/bundle.min.9bc659498fc45b111b2ed113be115802c52a7655c77845205d1328982715ac7d.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/blog/favicon.ico><meta name=color-scheme content="light dark"><title itemprop=name>gpk blog - Custom Static Vector Maps on your Hugo Static Site</title><meta property="og:title" content="gpk blog - Custom Static Vector Maps on your Hugo Static Site"><meta name=twitter:title content="gpk blog - Custom Static Vector Maps on your Hugo Static Site"><meta itemprop=name content="gpk blog - Custom Static Vector Maps on your Hugo Static Site"><meta name=application-name content="gpk blog - Custom Static Vector Maps on your Hugo Static Site"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://georgek.github.io/blog/posts/hugo-static-site-maps/><link rel=canonical href=https://georgek.github.io/blog/posts/hugo-static-site-maps/ itemprop=url><meta name=url content="https://georgek.github.io/blog/posts/hugo-static-site-maps/"><meta name=twitter:url content="https://georgek.github.io/blog/posts/hugo-static-site-maps/"><meta property="og:url" content="https://georgek.github.io/blog/posts/hugo-static-site-maps/"><meta property="og:updated_time" content="30010-30-10T1052:00:23Z"><link rel=sitemap type=application/xml title=Sitemap href=https://georgek.github.io/blog/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="27010-27-12T1011:00:23Z"><meta property="article:published_time" content="27010-27-12T1011:00:23Z"><meta property="og:article:author" content="George Kettleborough"><meta property="article:author" content="George Kettleborough"><meta name=author content="George Kettleborough"><meta name=generator content="Hugo 0.119.0"><script></script><link type=text/css rel=stylesheet href=/blog/css/bundle.min.2d163e2eadaafe7da23e1f887a4dde9ee7ce63020de038a9a8f17dd777c26528.css><style>:root{--sidebar-bg-color:#202420;--sidebar-img-border-color:#515751;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#3a3a3a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--code-block-color:#fff;--code-block-background-color:#272822;--moon-sun-color:#FFF;--moon-sun-background-color:#515751}@media screen{[data-theme=dark]{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#bdbdbd;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47;--code-block-color:#fff;--code-block-background-color:#272822}}body{background-color:var(--bkg-color)}</style><meta name=google-site-verification content="0kCOfXcz_aAJKh_eZglpQdpUUfE2IqecYZesW3oUOJo"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Lora:ital@0;1&family=Vollkorn:ital,wght@0,800;1,800&display=swap" rel=stylesheet><link rel=stylesheet href=https://georgek.github.io/blog/css/maplibre-gl.731181d400d65a8b09d842f55b70bc4dc11010b15b8549e2c65a69d233fbdd2e.css><script defer src=https://georgek.github.io/blog/js/mapbundle.min.8bd4d2a91deafa4229a45caddeb4672638b283c84dc61d0aec9d79d39a6ee67c.js integrity="sha256-i9TSqR3q+kIppFyt3rRnJjiyg8hNxh0K7J1505pu5nw="></script></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://georgek.github.io/blog/ class=brand-image><img src=/blog/android-chrome-192x192.png alt="brand image"></a><h1 class=brand><a href=https://georgek.github.io/blog/><h1>gpk blog</h1></a></h1><p class=lead>My ramblings about emacs, the internet and everything</p><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg display="none" class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg display="none" class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div></div><nav><ul class=sidebar-nav><li class=heading><a href=/blog/about/>About</a></li><li class=heading><a href=/blog/categories/>Categories</a></li><li class=heading><a href=/blog/tags/>Tags</a></li></ul></nav><div class=socials><a target=_blank class=social title=GitHub href=https://github.com/georgek><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title=Gitlab href=https://gitlab.com/gkettleborough><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2.5 24 24"><path fill="currentcolor" d="M10.006 18.443 6.326 7.118h7.36l-3.68 11.325zm0 0L1.168 7.118h5.158l3.68 11.325zM1.168 7.118l8.838 11.325-9.68-7.032a.762.762.0 01-.276-.852l1.118-3.441zm0 0L3.385.296a.38.38.0 01.724.0l2.217 6.822H1.168zm8.838 11.325 3.68-11.325h5.157l-8.837 11.325zm8.837-11.325 1.119 3.441a.762.762.0 01-.277.852l-9.68 7.032 8.838-11.325zm0 0h-5.157L15.902.296a.38.38.0 01.725.0l2.216 6.822z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://georgek.github.io/blog//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><a target=_blank class=social title=Email href=mailto://kettlegatgmail.com><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211"><path fill="currentcolor" d="M301.393 241.631 464.866 424.56H20.332l163.474-182.928 58.801 51.443 58.786-51.444zM462.174 60.651H23.027l219.579 192.142L462.174 60.651zM324.225 221.67l160.986 180.151V80.792L324.225 221.67zM0 80.792v321.029L160.972 221.64.0 80.792z"/></svg></a></div><p class=footnote>Powered by <a target=_blank href=https://gohugo.io>Hugo</a> | Themed with <a target=_blank href=https://github.com/georgek/poison>Poison</a></p><p class=footnote>© George Kettleborough
<a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target=_blank rel="license noopener noreferrer">CC BY-SA 4.0</a></p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://georgek.github.io/blog/posts/hugo-static-site-maps/>Custom Static Vector Maps on your Hugo Static Site</a></h1><time datetime=2023-10-27T00:11:00Z class=post-date>October 27, 2023</time>
· (Updated
<time datetime=2023-10-30T22:52:00Z class=post-date>October 30, 2023
</time>)<ul class=tags><li class=tag-hugo><a href=https://georgek.github.io/blog/tags/hugo>hugo</a></li><li class=tag-blog><a href=https://georgek.github.io/blog/tags/blog>blog</a></li><li class=tag-maps><a href=https://georgek.github.io/blog/tags/maps>maps</a></li></ul></div><p>This blog is a static site built with <a href=https://gohugo.io/ target=_blank>Hugo</a>. Being static means it can be served from a
basic, standard (you might say <em>stupid</em>) web server with no server-side scripting at
all. In fact, this blog is currently hosted on Github Pages, but it could be anywhere.</p><p>Up until now, if you wanted to include an interactive map on a static site you were
limited to using an external service like Google Maps or Mapbox and embedding their JS
into your page. This would then call to their non-static backend service to produce
some kind of tiles for your frontend.</p><p>But we can now put truly static maps into a static site. Behold!</p><div class=map data-tiles-url=/blog/bangor.pmtiles data-bounds=-4.178753,53.215670,-4.137597,53.231163 data-max-bounds=-4.199352,53.210916,-4.116955,53.235941></div><p>This isn&rsquo;t coming from a backend tile server. This is all completely static, it&rsquo;s all
hosted on GitHub Pages and the above map uses less than 2MiB of storage. What&rsquo;s more
it&rsquo;s really quite easy to get started. Let&rsquo;s see how it&rsquo;s done.</p><p>Although I&rsquo;m using Hugo as a concrete example below, all of this should be easily
translatable to any static site.</p><h2 id=generating-a-pmtiles-basemap>Generating a PMTiles basemap</h2><p>The magic here starts with <a href=https://protomaps.com/ target=_blank>Protomaps</a> and the PMTiles format. PMTiles is an archive
format for tile data which is designed to be accessed with HTTP range requests. As long
as the backend server supports HTTP range requests<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> then the client can figure out
which requests to make to get the tiles it needs.</p><p>This means our map data can be hosted anywhere, just like our static site.</p><p>You can create a PMTiles archive from raw map data (such as OpenStreetMap), but the
easiest way is to extract data from an existing archive. The Protomaps project produces
<a href=https://maps.protomaps.com/builds/ target=_blank>daily builds</a> of the entire world from OSM data. These files are over 100GiB but you can
extract a much smaller file without downloading the whole thing.</p><p>First download the latest release of go-pmtiles from <a href=https://github.com/protomaps/go-pmtiles/releases target=_blank>GitHub</a> for your platform and
extract it somewhere (preferably somewhere on your <code>PATH</code> like perhaps <code>~/.local/bin</code>).</p><p>Next you need to calculate a bounding box for your extract. I used <a href=http://bboxfinder.com target=_blank>bboxfinder.com</a>.
Draw a rectangle then copy the <strong>box</strong> at the bottom. It should look something like
<code>-16.273499,27.508271,-14.889221,28.386568</code>.</p><p>Make sure you keep a note of this bounding box for later!</p><p>Now, using <code>pmtiles</code> that you just installed, you can create your extract like so:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>pmtiles extract <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span><span style=color:#cb4b16></span>        https://build.protomaps.com/20231001.pmtiles <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span><span style=color:#cb4b16></span>        mymap.pmtiles <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4</span><span><span style=color:#cb4b16></span>        --bbox<span style=color:#719e07>=</span>-16.273499,27.508271,-14.889221,28.386568
</span></span></code></pre></div><p>You can test your basemap by visiting <a href=https://protomaps.github.io/PMTiles/ target=_blank>https://protomaps.github.io/PMTiles/</a> and selecting
your newly created pmtiles file.</p><p>Finally, put your PMTiles file into your Hugo static directory, for example
<code>static/mymap.pmtiles</code>.</p><h2 id=maplibre-gl>MapLibre GL</h2><p>Now you have a PMTiles extract you&rsquo;re happy with we need to render it somehow. For this
we can use <a href=https://github.com/maplibre/maplibre-gl-js target=_blank>maplibre-gl</a>.</p><p>If you haven&rsquo;t already, in your Hugo project directory initialise an npm project:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>npm init
</span></span></code></pre></div><p>Now install the required packages:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>npm install pmtiles
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>npm install maplibre-gl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span>npm install protomaps-themes-base
</span></span></code></pre></div><p>Now add the following as a JavaScript asset at <code>assets/js/map.js</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 1</span><span><span style=color:#268bd2>import</span> <span style=color:#719e07>*</span> as pmtiles from <span style=color:#2aa198>&#34;pmtiles&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 2</span><span><span style=color:#268bd2>import</span> <span style=color:#719e07>*</span> as maplibregl from <span style=color:#2aa198>&#34;maplibre-gl&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 3</span><span><span style=color:#268bd2>import</span> layers from <span style=color:#2aa198>&#39;protomaps-themes-base&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 5</span><span><span style=color:#268bd2>let</span> protocol <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> pmtiles.Protocol();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 6</span><span>maplibregl.addProtocol(<span style=color:#2aa198>&#34;pmtiles&#34;</span>,protocol.tile);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 8</span><span><span style=color:#268bd2>function</span> makeMap({tilesUrl, bounds, maxBounds, container <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;map&#34;</span>}) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050"> 9</span><span>    <span style=color:#268bd2>var</span> map <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> maplibregl.Map({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">10</span><span>        container<span style=color:#719e07>:</span> container,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">11</span><span>        style<span style=color:#719e07>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">12</span><span>            version<span style=color:#719e07>:</span> <span style=color:#2aa198>8</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">13</span><span>            glyphs<span style=color:#719e07>:</span> <span style=color:#2aa198>&#39;https://cdn.protomaps.com/fonts/pbf/{fontstack}/{range}.pbf&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">14</span><span>            sources<span style=color:#719e07>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">15</span><span>                <span style=color:#2aa198>&#34;protomaps&#34;</span><span style=color:#719e07>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">16</span><span>                    type<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;vector&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">17</span><span>                    url<span style=color:#719e07>:</span> <span style=color:#586e75>`pmtiles://</span><span style=color:#2aa198>${</span>tilesUrl<span style=color:#2aa198>}</span><span style=color:#586e75>`</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">18</span><span>                    attribution<span style=color:#719e07>:</span> <span style=color:#2aa198>&#39;&lt;a href=&#34;https://protomaps.com&#34;&gt;Protomaps&lt;/a&gt; © &lt;a href=&#34;https://openstreetmap.org&#34;&gt;OpenStreetMap&lt;/a&gt;&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">19</span><span>                }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">20</span><span>            },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">21</span><span>            layers<span style=color:#719e07>:</span> layers(<span style=color:#2aa198>&#34;protomaps&#34;</span>,<span style=color:#2aa198>&#34;light&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">22</span><span>        },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">23</span><span>        bounds<span style=color:#719e07>:</span> bounds,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">24</span><span>        maxBounds<span style=color:#719e07>:</span> maxBounds,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">25</span><span>    });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">26</span><span>    <span style=color:#719e07>return</span> map;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">27</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">29</span><span><span style=color:#b58900>document</span>.addEventListener(<span style=color:#2aa198>&#39;DOMContentLoaded&#39;</span>, <span style=color:#268bd2>function</span>(){
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">30</span><span>    <span style=color:#b58900>document</span>.querySelectorAll(<span style=color:#2aa198>&#34;div.map&#34;</span>).forEach((e) =&gt; {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">31</span><span>        makeMap({
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">32</span><span>            tilesUrl<span style=color:#719e07>:</span> e.dataset.tilesUrl,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">33</span><span>            bounds<span style=color:#719e07>:</span> e.dataset.bounds.split(<span style=color:#2aa198>&#34;,&#34;</span>).map(<span style=color:#b58900>parseFloat</span>),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">34</span><span>            maxBounds<span style=color:#719e07>:</span> e.dataset.maxBounds.split(<span style=color:#2aa198>&#34;,&#34;</span>).map(<span style=color:#b58900>parseFloat</span>),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">35</span><span>            container<span style=color:#719e07>:</span> e,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">36</span><span>        });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">37</span><span>    });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">38</span><span>});
</span></span></code></pre></div><p>What this does is finds every <code>div</code> on your page with the class <code>map</code> and creates a
maplibre-gl map there. It expects the <code>div.map</code> elements to have data attributes which
it uses to set up the map. Each <code>div</code> should look like this:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>&lt;<span style=color:#268bd2>div</span> class<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;map&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>     data-tiles-url<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;mymap.pmtiles&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span>     data-bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;-16.273499,27.508271,-14.889221,28.386568&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4</span><span>     data-max-bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;-16.273499,27.508271,-14.889221,28.386568&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5</span><span>&lt;/div&gt;
</span></span></code></pre></div><p>The bounds are what you saved earlier from running <code>pmtiles</code>. You should definitely set
<code>max-bounds</code> the same as your original bbox, but you can set <code>bounds</code> smaller, like I
have (bounds is the default zoom, maxBounds is the maximum span of the map).</p><p>Now let&rsquo;s put it all together with Hugo.</p><h2 id=building-with-hugo>Building with Hugo</h2><p>This section is quite dependent on your site and theme set up, so I can&rsquo;t give
specifics, but I hope you already have an idea of where to put CSS or JavaScript etc.
Some themes include provision for an <code>extra-head.html</code> or similar that you can put in
<code>layouts/partials</code>.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h3 id=javascript-bundle>JavaScript bundle</h3><p>Most of the work will be done by the JavaScript above, but we first need to bundle and
include it in our pages. This is done using Hugo Pipes.<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> Put the following in the
<code>&lt;head></code> section of your site, near other scripts:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>{{ $jsBundle := resources.Get &#34;js/map.js&#34; | js.Build &#34;js/mapbundle.js&#34; | minify | fingerprint }}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>&lt;<span style=color:#268bd2>script</span> defer src<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ $jsBundle.Permalink }}&#34;</span> integrity<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ $jsBundle.Data.Integrity }}&#34;</span>&gt;&lt;/<span style=color:#268bd2>script</span>&gt;
</span></span></code></pre></div><h3 id=css>CSS</h3><p>You&rsquo;ll need a couple of bits of CSS, first we need to style the <code>div.map</code> elements with
some sensible default at least, so add the following to a style sheet:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span><span style=color:#268bd2>div</span>.<span style=color:#268bd2>map</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>    <span style=color:#719e07>width</span>: <span style=color:#2aa198>100</span><span style=color:#dc322f>%</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span>    <span style=color:#719e07>height</span>: <span style=color:#2aa198>500</span><span style=color:#dc322f>px</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4</span><span>    <span style=color:#719e07>margin-bottom</span>: <span style=color:#2aa198>1</span><span style=color:#dc322f>rem</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5</span><span>}
</span></span></code></pre></div><p>You also need maplibgre-gl&rsquo;s style. First mount the stylesheet from <code>node_modules</code> in
Hugo&rsquo;s <code>assets</code> by adding to your Hugo config:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span><span style=color:#268bd2>module</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>  <span style=color:#268bd2>mounts</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span>    - <span style=color:#268bd2>source</span>: <span style=color:#2aa198>&#34;assets&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4</span><span>      <span style=color:#268bd2>target</span>: <span style=color:#2aa198>&#34;assets&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5</span><span>    - <span style=color:#268bd2>source</span>: <span style=color:#2aa198>&#34;node_modules/maplibre-gl/dist/maplibre-gl.css&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">6</span><span>      <span style=color:#268bd2>target</span>: <span style=color:#2aa198>&#34;assets/css/maplibre-gl.css&#34;</span>
</span></span></code></pre></div><p>Do not forget the default mount for <code>assets</code>. Now in your <code>&lt;head></code> section add the
stylesheet:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>{{ $style := resources.Get &#34;css/maplibre-gl.css&#34; | fingerprint }}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>&lt;<span style=color:#268bd2>link</span> rel<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;stylesheet&#34;</span> href<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ $style.Permalink }}&#34;</span>&gt;
</span></span></code></pre></div><h3 id=hugo-shortcode>Hugo shortcode</h3><p>To insert the <code>div.map</code> element into your markdown posts you&rsquo;ll need a shortcode. Put
the following in <code>layouts/shortcodes/map.html</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>&lt;<span style=color:#268bd2>div</span> class<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;map&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">2</span><span>     data-tiles-url<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ .Get &#34;</span>tiles-url&#34; }}&#34;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">3</span><span>     data-bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ .Get &#34;</span>bounds&#34; }}&#34;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">4</span><span>     data-max-bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;{{ .Get &#34;</span>max-bounds&#34; }}&#34;&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">5</span><span>&lt;/<span style=color:#268bd2>div</span>&gt;
</span></span></code></pre></div><p>Now you can simply use the shortcode anywhere in your site like so:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span>{{&lt;<span style=color:#268bd2>map</span> tiles-url<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;/blog/gran-canaria2.pmtiles&#34;</span> bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;-15.923996,27.713926,-15.308075,28.205793&#34;</span> max-bounds<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;-16.273499,27.508271,-14.889221,28.386568&#34;</span>&gt;}}
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>I can&rsquo;t believe how easy this has been for me to set up. Here&rsquo;s to <a href=https://protomaps.com/ target=_blank>Protomaps</a>, <a href=https://maplibre.org/ target=_blank>MapLibre
GL</a> and, of course, <a href=https://www.openstreetmap.org/ target=_blank>OpenStreetMap</a>!</p><p>I had previously tried setting up my own custom maps and found it quite difficult to
get started, not to mention requiring me to run a special tileserver somewhere or use a
third party service. I&rsquo;m by no means a map expert (although I am an OpenStreetMap
contributor of many years, if that means anything), so I find this post a testament to
how far the work of the free/open mapping community has come.</p><p>Of course, this approach isn&rsquo;t suitable for everything and comes with drawbacks. In
particular, your map will never receive updates unless you update the pmtiles file.
This could be particularly bad if your area doesn&rsquo;t have good OpenStreetMap coverage.</p><p>But, for me, this is static by design. I <em>want</em> these pages to be static, including the
map. If I include a route showing where I walked, it doesn&rsquo;t make sense for it to
appear on some map of the future. It <em>should</em> be a map of the past.</p><p>Also, let&rsquo;s not forget that maps don&rsquo;t have to contain &ldquo;real&rdquo; data. It could contain a
planned development or even just a fantasy world. There are many possibilities. Next
on my list to play is to try to get hillshading/relief into my maps.</p><p>To finish, just for fun, here&rsquo;s another map showing a recent multi-day walk across Gran
Canaria<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>:</p><div class=map data-tiles-url=/blog/gran-canaria2.pmtiles data-relief-tiles-url=/blog/gran-canaria-relief.pmtiles data-tracks=/blog/gc1.gpx,/blog/gc2.gpx,/blog/gc3.gpx,/blog/gc4.gpx data-bounds=-15.923996,27.713926,-15.308075,28.205793 data-max-bounds=-16.273499,27.508271,-14.889221,28.386568></div><h2 id=appendix>Appendix</h2><h3 id=org-mode-and-ox-hugo>org-mode and ox-hugo</h3><p>I don&rsquo;t write my blog in Markdown directly, but in org-mode first and use ox-hugo to
export it. There are a <a href=https://ox-hugo.scripter.co/doc/shortcodes/ target=_blank>few</a> ways to add shortcodes, but the neatest I&rsquo;ve found for the
map shortcodes is simply:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-org data-lang=org><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#495050">1</span><span><span style=color:#719e07>#+hugo</span><span style=color:#586e75>: {{&lt;map tiles-url=&#34;/blog/bangor.pmtiles&#34; bounds=&#34;-4.178753,53.215670,-4.137597,53.231163&#34; max-bounds=&#34;-4.199352,53.210916,-4.116955,53.235941&#34;&gt;}}</span>
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Most do, but not all. Notably I found the dev server used by the <a href=https://parceljs.org/ target=_blank>Parcel</a> bundler
does not, which led to much head scratching.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Overriding a theme is quite easy with Hugo, see:
<a href=https://bwaycer.github.io/hugo_tutorial.hugo/themes/customizing/ target=_blank>https://bwaycer.github.io/hugo_tutorial.hugo/themes/customizing/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>If you are unfamiliar with Hugo Pipes you can read all about it <a href=https://www.regisphilibert.com/blog/2018/07/hugo-pipes-and-asset-processing-pipeline/ target=_blank>here</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>I&rsquo;ve used <a href=https://github.com/jimmyrocks/maplibre-gl-vector-text-protocol target=_blank>maplibre-gl-vector-text-protocol</a> to add statically hosted GPX files to
the map. See the <a href=https://github.com/georgek/blog target=_blank>source</a> of my blog to see how.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><hr><div class=footer><a class=previous-post href="https://georgek.github.io/blog/posts/multiple-web-projects-traefik/?ref=footer"><span style=font-weight:700>« Previous</span><br>Working on Multiple Web Projects with Docker...</a></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#generating-a-pmtiles-basemap>Generating a PMTiles basemap</a></li><li><a href=#maplibre-gl>MapLibre GL</a></li><li><a href=#building-with-hugo>Building with Hugo</a><ul><li><a href=#javascript-bundle>JavaScript bundle</a></li><li><a href=#css>CSS</a></li><li><a href=#hugo-shortcode>Hugo shortcode</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#org-mode-and-ox-hugo>org-mode and ox-hugo</a></li></ul></li></ul></nav></div></div></div></body></html>